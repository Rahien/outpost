scenarios = {
  "1": {
      "name": "A Town in Flames",
      "links": [
        "2", "3"
      ],
  },
  "2": {
      "name": "Algox Scouting",
      "links": [ "4" ],
  },
  "3": {
      "name": "Algox Offensive",
      "links": [ "4" ],
  },
  "4": {
      "name": "Heart of Ice",
      "icons": ["boss"],
      "links": [ "5", "6", "7" ]
  },
  "5": {
      "name": "Frozen Crypt",
      "links": [ "9", "10" ],
  },
  "6": {
      "name": "Avalanche",
      "links": [ "11", "12" ],
  },
  "7": {
      "name": "Edge of the World",
      "links": [ "13", "14" ],
  },
  "8": {
      "name": "Crystal Trench",
      "links": [ "15", "16" ],
  },
  "9": {
      "name": "Glowing Catacombs",
      "links": [ "17"],
  },
  "10": {
      "name": "Crystal Enclosure",
      "links": [ "18" ],
      "icons": ["sled"]

  },
  "11": {
      "name": "Snowscorn Peak",
      "links": [ "19" ],
      "icons": ["climbing", "boss"]
  },
  "12": {
      "name": "Temple Entrance",
      "links": [ "20" ],
  },
  "13": {
      "name": "Frozen Fjord",
      "links": [ "21", "32" ],
  },
  "14": {
      "name": "Jagged Shoals",
      "links": [ "22" ],
      "icons": ["boat"]
  },
  "15": {
      "name": "Ancient Spire",
      "links": [ "23", "24" ]
  },
  "16": {
      "name": "Derelict Elevator",
      "links": [ "25", "26" ]
  },
  "17": {
      "name": "Haunted Vault",
      "links": [ "27" ]
  },
  "18": {
      "name": "Crystal Fields",
      "links": [ "29", "28" ]
  },
  "19": {
      "name": "Skyhall",
      "links": [ "28", "30" ]
  },
  "20": {
      "name": "Temple of Liberation",
      "links": [ "31" ]
  },
  "21": {
      "name": "Realm of Endless Frost",
      "icons": ["sled", "boss"]
  },
  "22": {
      "name": "Ice Floes",
      "links": [ "33" ],
      "icons": ["boat"]
  },
  "23": {
      "name": "Spire Basement",
      "links": [ "34" ]
  },
  "24": {
      "name": "Upper Spire",
      "links": [ "34" ]
  },
  "25": {
      "name": "Rusted Tunnels",
      "links": [ "35" ]
  },
  "26": {
      "name": "Quatryl Library",
      "links": [ "36", "37" ]
  },
  "27": {
      "name": "Depths of Delirium",
      "icons": ["shard"]
  },
  "28": {
      "name": "Summit Meeting",
      "links": [ "38" ]
  },
  "29": {
      "name": "War of the Spire A",
      "links": [ "39" ]
  },
  "30": {
      "name": "War of the Spire B",
      "links": [ "40" ]
  },
  "31": {
      "name": "Crackling Tunnel",
      "links": [ "41" ]
  },
  "32": {
      "name": "Ravens' Roost",
  },
  "33": {
      "name": "Thawed Wood",
      "links": [ "42" ]
  },
  "34": {
      "name": "Top of the Spire",
      "icons": ["boss"],
  },
  "35": {
      "name": "Scrap Pit",
      "links": [ "43" ]
  },
  "36": {
      "name": "Buried Ducts",
      "links": [ "44" ]
  },
  "37": {
      "name": "The Dead Mile",
      "links": [ "44" ]
  },
  "38": {
      "name": "The Way Forward",
      "links": [ "45", "46" ]
  },
  "39": {
      "name": "The Corrupted Camp",
      "links": [ "47" ]
  },
  "40": {
      "name": "Relief Effort",
      "links": [ "48" ]
  },
  "41": {
      "name": "Unfettered Shard",
      "icons": ["shard"],
  },
  "42": {
      "name": "Sunless Trench",
      "links": [ "49", "50" ],
      "icons": ["boat"]
  },
  "43": {
      "name": "Overrun Barricade",
      "links": [ "51" ]
  },
  "44": {
      "name": "Nerve Center",
      "links": [ "58", "59" ]
  },
  "45": {
      "name": "Living Glacier",
      "links": [ "52" ],
      "icons": ["climbing"]
  },
  "46": {
      "name": "Dead Pass",
      "links": [ "52" ],
      "icons": ["sled"]
  },
  "47": {
      "name": "Carrion Ridge",
      "links": [ "56" ]
  },
  "48": {
      "name": "Blizzard island",
      "links": [ "57" ],
      "icons": ["boat"]
  },
  "49": {
      "name": "Beneath Sea and Stone",
      "icons": ["boat"],
  },
  "50": {
      "name": "Explosive Descent",
      "links": [ "54" ],
      "icons": ["boat"]
  },
  "51": {
      "name": "Orphan's Halls",
      "links": [ "58", "59" ]
  },
  "52": {
      "name": "Fleeting Permanence",
      "links": [ "55" ]
  },
  "53": {
      "name": "Underwater Throne",
      "links": [ "60" ],
      "icons": ["boat"]
  },
  "54": {
      "name": "Among th Wreckage",
      "links": [ "60" ],
      "icons": ["boat", "boss"]
  },
  "55": {
      "name": "Change of Heart",
      "icons": ["boss"],
  },
  "56": {
      "name": "Call of the Harbinger",
      "icons": ["boss"],
  },
  "57": {
      "name": "Sanctuary of Snow",
      "icons": ["boat", "boss"],
  },
  "58": {
      "name": "Orphan's Core",
      "icons": ["boss"]
  },
  "59": {
      "name": "Automation Uprising",
  },
  "60": {
      "name": "Uniting the Crown",
      "icons": ["boss", "boat", "crown"],
  },
  "61": {
      "name": "Life and Death",
      "links": [ "62" ],
  },
  "62": {
      "name": "The Unfettered Seal",
      "links": [ "63" ]
  },
  "63": {
      "name": "The Savvas Seal",
      "links": [ "64" ]
  },
  "64": {
      "name": "The Frosthaven Seal",
      "icons": ["boss"]
  },
  "65": {
      "name": "A Strong Foundation",
      "links": [ "66" ],
  },
  "66": {
      "name": "Elemental Cores",
      "links": [ "67" ],
  },
  "67": {
      "name": "Core Attunement",
      "links": [ "68" ],
  },
  "68": {
      "name": "The Face of Torment",
      "icons": ["boss"],
  },
  "69": {
      "name": "Sacred Soil",
      "links": [ "70" ],
  },
  "70": {
      "name": "The True Oak",
  },
  "71": {
      "name": "Invasion of the Dock",
      "links": [ "72" ],
  },
  "72": {
      "name": "A Giant Block of Ice",
      "links": [ "73" ],
  },
  "73": {
      "name": "Flotsam",
      "links": [ "74" ],
      "icons": ["boss"]
  },
  "74": {
      "name": "Gaps in the Road",
      "links": [ "75", "76" ],
  },
  "75": {
      "name": "Infiltrating the Lair",
      "links": [ "77" ],
      "icons": ["boat"]
  },
  "76": {
      "name": "Apotheosis",
      "links": [ "77" ],
      "icons": ["boat", "boss"]
  },
  "77": {
      "name": "Fish King's Ascension",
      "icons": ["boss", "boat"],
  },
  "78": {
      "name": "The Lurker Problem",
      "icons": ["climbing"]
  },
  "79": {
      "name": "Relic",
      "links": [ "80" ],
      "icons": ["sled"]
  },
  "80": {
      "name": "Relic Renewed",
      "icons": ["boss"],
  },
  "81": {
      "name": "Ruinous Research Lab",
  },
  "82": {
      "name": "Expedition North",
  },
  "83": {
      "name": "Rising Brine",
      "icons": ["boat", "boss"],
  },
  "84": {
      "name": "Here There Be Oozes",
      "icons": ["boss"]
  },
  "85": {
      "name": "Deadly Pastimes",
      "icons": ["climbing"]
  },
  "86": {
      "name": "The Lady in White",
  },
  "87": {
      "name": "The Collection",
      "links": [ "88" ]
  },
  "88": {
      "name": "Collection's Capstone",
      "icons": ["boss"],
  },
  "89": {
      "name": "A Contained Fire",
  },
  "90": {
      "name": "Frozen Treasure",
      "links": [ "91" ],
  },
  "91": {
      "name": "Shoreline Scramble",
  },
  "92": {
      "name": "Sinking Ship",
  },
  "93": {
      "name": "Midwinter Brawl",
  },
  "94": {
      "name": "A Grand View",
      "links": [ "95" ],
  },
  "95": {
      "name": "To Burry the Dead",
  },
  "96": {
      "name": "Underground Station",
      "links": [ "97" ],
      "icons": ["climbing"]
  },
  "97": {
      "name": "Program Control Nexus",
      "links": ["98"],
      "icons": ["boss"]
  },
  "98": {
      "name": "Collapsing Vent",
  },
  "99": {
      "name": "Prison Break",
      "links": [ "100"],
  },
  "100": {
      "name": "Inside the Swarm",
      "links": [ "101"],
  },
  "101": {
      "name": "Harrower Library",
      "links": [ "102" ],
  },
  "102": {
      "name": "Into the Black",
      "links": [ "103" ],
  },
  "103": {
      "name": "The Lead Door",
  },
  "104": {
      "name": "Ruins of the Solstice",
      "links": [ "105" ],
      "icons": ["sled"]
  },
  "105": {
      "name": "Ruins of the Equinox",
      "links": [ "106" ],
      "icons": ["climbing"]
  },
  "106": {
      "name": "The Tempus Forge",
  },
  "107": {
      "name": "My Private Empire",
      "icons": ["climbing"]
  },
  "108": {
      "name": "Lustrous Pit",
  },
  "109": {
      "name": "Furious Factory",
      "icons": ["sled"]
  },
  "110": {
      "name": "Guardian's Temple",
      "icons": ["climbing"]
  },
  "111": {
      "name": "Ice Cave",
      "icons": ["sled"]
  },
  "112": {
      "name": "Raised by Wolves",
  },
  "113": {
      "name": "Lush Grotto",
  },
  "114": {
      "name": "Work Freeze",
      "links": [ "115" ],
  },
  "115": {
    "name": "Pylon Problems",
    "links": [ "116" ],
  },
  "116": {
      "name": "Caravan Guards",
  },
  "117": {
      "name": "A Waiting Game",
  },
  "118": {
      "name": "Lurker Necromancy",
      "icons": ["sled"]
  },
  "119": {
      "name": "Radiant Dust",
  },
  "120": {
      "name": "Under the Influence",
      "links": [ "121" ],
  },
  "121": {
      "name": "Black Memories",
  },
  "122": {
      "name": "The Eternal Crave",
  },
  "123": {
      "name": "The Titan",
  },
  "124": {
      "name": "A Growing Problem",
      "links": [ "125" ],
  },
  "125": {
      "name": "The Longest Second",
  },
  "126": {
      "name": "Joseph the Lion",
  },
  "127": {
      "name": "Derelict Freighter",
  },
  "128": {
      "name": "A Tall Drunken Tale",
      "links": [ "129" ],
  },
  "129": {
      "name": "How to lay an Ambush",
      "links": [ "130" ],
  },
  "130": {
      "name": "And Then, a Stream",
  },
  "131": {
      "name": "The Dancing Iceberg",
  },
  "132": {
      "name": "Temple of Feline Power",
      "links": [ "133" ],
      "icons": ["climbing"]
  },
  "133": {
      "name": "Bolt",
  },
  "134": {
      "name": "Tower of Knowledge",
  },
  "135": {
      "name": "Belara's Keep",
  },
  "136": {
      "name": "Abandoned Hideout",
      "icons": ["boat"]
  },
  "137": {
      "name": "Pirate Queen's Haul",
      "icons": ["boat"]
  },
}

def enrich_scenarios():
  for key, scenario in scenarios.items():
    scenario["number"] = key
    links = scenario.get("links", [])
    scenario["links"] = links
    for link in links:
      scenarios[link]["origins"] = scenarios[link].get("origins", [])
      scenarios[link]["origins"].append(key)

  for key, scenario in scenarios.items():
    if "origins" not in scenario:
      scenario["origins"] = []
    if "links" not in scenario:
      scenario["links"] = []
    current = scenario
    count_back = 0
    while current and count_back < 100: # loop protection
      count_back += 1

      next_id = current["origins"][0] if current["origins"] else None # we don't know how we got here, let's take the first origin
      next_scenario = scenarios.get(next_id, None)
      current = next_scenario

    count_forward = -1
    current = scenario
    while current and count_forward < 100: # loop protection
      count_forward += 1

      next_id = current["links"][0] if current["links"] else None # same story, don't know where we're going
      next_scenario = scenarios.get(next_id, None)
      current = next_scenario

    scenario["step"] = count_back
    scenario["length"] = count_back + count_forward


enrich_scenarios()
